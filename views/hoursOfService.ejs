<!DOCTYPE html>
<html dir="ltr" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- Favicon icon -->
    <!-- <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon.png"> -->
    <title>
        <%- title %>
    </title>
    <!-- Custom CSS -->
    <link href="assets/libs/flot/css/float-chart.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="dist/css/style.min.css" rel="stylesheet">
    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
    <link rel="stylesheet" type="text/css" href="assets/extra-libs/multicheck/multicheck.css">
    <link href="assets/libs/datatables.net-bs4/css/dataTables.bootstrap4.css" rel="stylesheet">
    <link href="dist/css/style.min.css" rel="stylesheet">
    <link rel="stylesheet" href="sweetAlert/sweetalert2.min.css">
    <link rel="stylesheet" type="text/css"
        href="assets/libs/bootstrap-datepicker/dist/css/bootstrap-datepicker.min.css">
    <style type="text/css">
        .gap {
            text-align: center;
            background-color: #e2181870;

        }

        .thClass {
            font-size: 18px;
            font-weight: bold;
        }

        .disableClick {
            pointer-events: none;
        }

        .modal {
            padding: 0 !important;
        }

        .modal .modal-dialog {
            width: 100%;
            max-width: none;
            height: 100%;
            margin: 0;
        }

        .modal .modal-content {
            height: 100%;
            border: 0;
            border-radius: 0;
        }

        .modal .modal-body {
            overflow-y: auto;
        }
    </style>
</head>

<body>
    <!-- ============================================================== -->
    <!-- Preloader - style you can find in spinners.css -->
    <!-- ============================================================== -->
    <div class="preloader">
        <div class="lds-ripple">
            <div class="lds-pos"></div>
            <div class="lds-pos"></div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- Main wrapper - style you can find in pages.scss -->
    <!-- ============================================================== -->
    <div id="main-wrapper">
        <!-- ============================================================== -->
        <!-- Topbar header - style you can find in pages.scss -->
        <!-- ============================================================== -->

        <%- include('includes/header.ejs') %>
            <%- include('includes/sidebarDriver.ejs') %>

                <!-- Page wrapper  -->
                <!-- ============================================================== -->
                <div class="page-wrapper">
                    <!-- ============================================================== -->
                    <!-- Bread crumb and right sidebar toggle -->
                    <!-- ============================================================== -->
                    <div class="page-breadcrumb">
                        <div class="row">
                            <div class="col-12 d-flex no-block align-items-center">
                                <h4 class="page-title">
                                    <%- title %>
                                </h4>
                                <div class="ml-auto text-right">
                                    <nav aria-label="breadcrumb">
                                        <ol class="breadcrumb">
                                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                                            <li class="breadcrumb-item active" aria-current="page">
                                                <%- title %>
                                            </li>
                                        </ol>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- ============================================================== -->
                    <!-- End Bread crumb and right sidebar toggle -->
                    <!-- ============================================================== -->
                    <!-- ============================================================== -->
                    <!-- Container fluid  -->
                    <!-- ============================================================== -->
                    <div class="container-fluid" style="background-color: #fff; ">
                        <div class="container-fluid" style="background-color: #fff; ">





                            <div class="card-body">
                                <div class="row p-b-30" id="">
                                    <div class="col-12">
                                        <div class="card-body" id="updateEmployment_details">
                                            <!-- <h3 align="center" class="card-title">Create company</h3> -->
                                            <!-- <div style="text-align: center;"> -->
                                            <!-- <span> -->
                                            <!-- <h3>
                                                        DRIVER ACKNOWLEDGEMENT
                                                    </h3> -->
                                            <!-- </span> -->
                                            <!-- <img style="width: 70%" src="images/truck_company.png" alt="homepage" class="light-logo" /> -->
                                            <!-- </div> -->
                                            <form class="form-horizontal" id="updateEmployment">
                                                <div class="row">
                                                    <div class="col-md-12">


                                                        <input type="hidden" name="company_id" id="company_id"
                                                            value="<%-company_id %>">
                                                        <input type="hidden" name="driverId" id="driverId"
                                                            value="<%-driverId %>">
                                                        <center>
                                                            <i style="font-size: 75px;" class="mdi mdi-clock-fast"></i>
                                                            <br>
                                                            <h3>Statement of Hours of Service
                                                            </h3>
                                                        </center>

                                                        <p align="justify">New Hires, Contractors, Casual & Temporary
                                                            Employees</p>
                                                        <hr>
                                                        <b> Name:</b>
                                                        <%-driverName %>
                                                            <hr>

                                                            <div class="row">
                                                                <div class="col-md-4"><b>Drivers Licence Number: </b>
                                                                    <%-driver_license %>
                                                                </div>
                                                                <div class="col-md-4"><b>Class of License:</b>
                                                                    <%-getDrivinghistoryaddressLicense %>
                                                                </div>
                                                                <div class="col-md-4"><b> Issuing Province:</b>
                                                                    <%-getDrivinghistoryaddressProvince %>
                                                                </div>
                                                            </div>

                                                            <hr>
                                                            <!-- <b> Name:</b>
                                                        <%-driverName %> &nbsp;
                                                            <b>Drivers Licence Number: </b> &nbsp;
                                                            <%-driver_license %>
                                                                <b>Class of License:</b> &nbsp;
                                                                <%-driverName %> -->

                                                            <p align="justify">
                                                                Section 81. (2)(c) The motor carrier maintains
                                                                accurate and
                                                                legible records showing, for each day, the
                                                                driver's duty status
                                                                and elected cycle, the hour at which each duty
                                                                status
                                                                begins and ends and the total number of hours
                                                                spent in each
                                                                status and keeps those records for a minimum
                                                                period of 6 months
                                                                after the day on which they were recorded.

                                                                Section 84. No driver who is required to fill
                                                                out a daily log
                                                                shall drive and no motor carrier shall request,
                                                                require or allow
                                                                the driver to drive unless the driver has in
                                                                their possession
                                                                (a) a copy of the daily logs for the preceding
                                                                14 days and, in
                                                                the case of a driver driving under an oil well
                                                                service permit,
                                                                for each of the required 3 periods of 24
                                                                consecutive hours of
                                                                off-duty time in any period of 24 days; (b) the
                                                                daily log for
                                                                the current day, completed up to the time at
                                                                which the last
                                                                change in the driver’s duty status occurred;
                                                                <br>


                                                            </p>
                                                            <div class="row">
                                                                <div class="col-md-7">
                                                                    <input required class="form-check-input" id="Iagree"
                                                                        name="Iagree" type="checkbox" value="1"
                                                                        id="flexCheckDefault Iagree">

                                                                    <b> I hereby certify that the
                                                                        information given
                                                                        below is correct to
                                                                        the best of my knowledge and belief,and that I
                                                                        was
                                                                        last relieved from work at: </b>
                                                                </div>
                                                                <div class="col-md-3">
                                                                    <input required type="number" placeholder="Duration"
                                                                        class="form-control" name="durationData"
                                                                        value="<%-hosdurationData %>" id="durationData">
                                                                    <br>
                                                                    on
                                                                    <br>
                                                                    <input required type="date" class="form-control"
                                                                        name="dateData" value="<%-hosdateData %>"
                                                                        id="dateData">
                                                                </div>
                                                            </div>
                                                            <hr>
                                                            INSTRUCTIONS: Day 1 is the day before you first begin work
                                                            for
                                                            this motor carrier. The dates have been pre-filled based on
                                                            today's date. If you need to change the DAY 1 date, Click here
                                                            <br><br>
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <label> <b>Select Date</b></label>
                                                                    <input type="date" class="form-control"
                                                                        name="selectedDate" id="selectedDate"
                                                                        value="<%-hosselectedDate %>">
                                                                </div>
                                                            </div>
                                                    </div>


                                                    <div style="width: 100%" class="container1">
                                                        <!-- <button class="add_form_field">Add Employement history &nbsp;
                                                                <span style="font-size:16px; font-weight:bold;">+
                                                                </span>
                                                            </button> -->
                                                    </div>


                                                    <br>
                                                    <div class="row1">
                                                        <%if (getDrivinghistorySignature !="" ) { %>
                                                            <b>Employee Signature:</b> <img
                                                                src="uploads/attachment/drivinghistoryaddressSignature/<%- getDrivinghistorySignature %>"
                                                                alt="user" width="150"></a> <br>
                                                            <% } %>
                                                                <br>
                                                                <!-- <img src="" id="signature" alt="user" width="150"></a> -->


                                                                <b> Name:</b>
                                                                <%-driverName %> <br>
                                                                    <b>Drivers Licence Number: </b>
                                                                    <%-driver_license %> <br>
                                                                        <b>Date: </b>
                                                                        <%-hoscreatedAt %> <br>

                                                                            <%if (hosAttachment_attachment=="" ) { %>
                                                                                <b>HOS Attachment : </b>
                                                                                <input id="hosAttachment" type="file"
                                                                                    accept="application/pdf" accept=""
                                                                                    onchange="convertToBase64('hosAttachment','hosAttachment_file');" />
                                                                                <input type="hidden"
                                                                                    name="hosAttachment_file"
                                                                                    id="hosAttachment_file">
                                                                                <% } else{ %>
                                                                                    <%if (hosAttachment_attachment
                                                                                        !="undefined" ) { %>
                                                                                        <a target="_blank"
                                                                                            class="btn btn-primary"
                                                                                            href="/uploads/attachment/hosAttachment/<%- hosAttachment_attachment %>">View
                                                                                            Attachment </a>
                                                                                        <% } %>
                                                                                            <% } %>

                                                    </div>


                                                </div>
                                                <br>
                                                <a class="btn btn-warning col-sm-3" id="durationCalc">Calculate Duration
                                                    &nbsp;
                                                    <span style="font-size:16px; font-weight:bold;">
                                                    </span>
                                                </a><br>
                                                <div id="" class="col-md-9">
                                                    <span style="font-size:20px">Total Duration : </span><span
                                                        style="font-size:20px" id="totalDurationData">
                                                        <%-totalDuration %>
                                                    </span>
                                                </div>



                                                <div class="border-top">
                                                    <div style="text-align: center;" class="card-body">
                                                        <button type="Submit" id="submitBtn"
                                                            class="btn btn-primary"></button>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>

                                    </div>




                                </div>


                            </div>



                            <table id="table" class="table table-striped table-bordered">
                                <thead>
                                    <tr>
                                        <!-- <th>Id</th> -->
                                        <th class="thClass">Sl</th>
                                        <th class="thClass">Date</th>
                                        <th class="thClass">Duration</th>
                                        <!-- <th class="thClass">Delete</th> -->
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- <span id="tableDtls"></span> -->


                                </tbody>
                            </table>
                        </div>




                    </div>

                </div>



    </div>
    <!-- ============================================================== -->
    <!-- End Container fluid  -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <!-- footer -->
    <!-- ============================================================== -->
    <footer class="footer text-center">
        <!-- All Rights Reserved by Matrix-admin. Designed and Developed by <a href="https://wrappixel.com">WrapPixel</a> -->
    </footer>
    <!-- ============================================================== -->
    <!-- End footer -->
    <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- End Page wrapper  -->
    <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- End Wrapper -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <%- include('includes/footer.ejs') %>
        <script src="assets/extra-libs/multicheck/datatable-checkbox-init.js"></script>
        <script src="assets/extra-libs/multicheck/jquery.multicheck.js"></script>
        <script src="assets/extra-libs/DataTables/datatables.min.js"></script>
        <script src="assets/libs/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js"></script>
        <script>
            //   jQuery(document).ready(function () {

            // $("#toDate").on("change",function(){
            //                 $("#toDate").focusout(function() {
            //                 alert('qwwe')
            //     var selected = $(this).val();
            //     alert(selected);
            // });

            function convertToBase64(inputfile, parms) {
                //Read File
                // alert(inputfile)
                // alert(parms)

                var selectedFile = document.getElementById(inputfile).files;
                console.log(selectedFile);
                //Check File is not Empty
                if (selectedFile.length > 0) {
                    // Select the very first file from list
                    var fileToLoad = selectedFile[0];
                    var filesize = selectedFile[0].size;
                    if (filesize <= '2069405') {
                        console.log(filesize);
                        // FileReader function for read the file.
                        var fileReader = new FileReader();
                        var base64;
                        // Onload of file read the file content
                        fileReader.onload = function (fileLoadedEvent) {
                            base64 = fileLoadedEvent.target.result;
                            // Print data in console
                            console.log(parms);
                            $("#" + parms).val(base64);
                            var div = document.getElementById(parms);
                            div.innerHTML += base64;

                        };
                        // Convert data to base64
                        fileReader.readAsDataURL(fileToLoad);
                    } else {
                        Swal.fire(
                            'Too Big!',
                            'Upload image size within 2 MB.',
                            'danger'
                        )
                        return false;
                    }
                }
            }


            $(document).ready(function () {
                $("body #updateEmployment_details #submitBtn").text('Create');
                $("body #updateEmployment_details #submitBtn").show();


                let driverId = $("#driverId").val();
                $.ajax({
                    url: "/getHosDtls",
                    type: "GET",
                    data: { driverId: driverId },
                    success: function (data) {
                        console.log(data);
                        if (data.status) {
                            $("body #updateEmployment_details #submitBtn").hide();
                            $("body #durationCalc").hide();
                            $("body #totalDuration").show();
                            $("body #table tbody").html(data.data);
                            // $('body #viewmodal >table > tbody').html(data.data);
                            $('#Iagree').attr('checked', 'checked');
                            $('#Iagree').attr('disabled', true);

                        } else {
                            // $("body #scratchentry").show();
                            $("body #table").hide();
                            $("body #updateEmployment_details #submitBtn").text('Create');
                        }

                    }
                });




                // let company_id = $("#company_id").val();
                // let driverId = $("#driverId").val();
                // // alert(driverId)
                // $.ajax({
                //     url: "/getHosDtls",
                //     type: "GET",
                //     data: { driverId: driverId },
                //     success: function (data) {
                //         // console.log(data);
                //         // alert(data.status)
                //         if (data.status) {
                //             // alert('test')
                //             //  $("body #updateEmployment_details #submitBtn").hide();
                //             $('#Iagree').attr('checked', 'checked');
                //             $('#Iagree').attr('disabled', true);

                //         } else {
                //             alert('sdf')
                //             $("body #updateEmployment_details #submitBtn").text('Create');
                //             $('#Iagree').show();
                //         }

                //     }
                // });
            })




            $(document).ready(function () {

                jQuery('.mydatepicker').datepicker({
                    format: 'dd/mm/yyyy',
                    closeOnSelected: true,
                    autoclose: true,
                });
                jQuery('#datepicker-autoclose').datepicker({
                    autoclose: true,
                    todayHighlight: true,
                    maxDate: new Date()
                });

                // --------------------------------------Multiple form---------------------------------
                $(document).ready(function () {


                    $(document).on('click', '#durationCalc', function () {
                        // $('#duration').on('change', function () {

                        var duration = $("input[name='duration[]']")
                            .map(function () { return $(this).val(); }).get();
                        console.log(duration);

                        var res = duration.reduce(function (prev, curr) {
                            return (Number(prev) || 0) + (Number(curr) || 0);
                        });
                        $("#totalDurationData").text(res);
                        console.log(res);
                        // console.log(sum);
                    })

                    $('#selectedDate').on('change', function () {

                        let aa = $("#selectedDate").val();
                        // alert(aa)
                        // var max_fields = 10;
                        var wrapper = $(".container1");
                        var add_button = $(".add_form_field");
                        $(wrapper).html('');
                        // multiple selectbox/
                        var x = 1;
                        for (let i = 0; i < 15; i++) {
                            if (i != 0) {
                                var d = new Date(aa);
                                // var d = new Date(2022, 08, 01, 00, 00, 00);
                                console.log(aa);
                                let temp = formatDate(d);
                                console.log(temp);

                                if (aa != temp) {
                                    d.setDate(d.getDate() + 1);
                                }


                                // d.setDate(d.getDate() + 1);
                                // console.log(d)


                                d.setDate(d.getDate() - i);
                                // console.log(d);
                                let setdata = formatDate(d);
                                // console.log(setdata);
                                // $(wrapper).append('<div>   <div class="form-group row"><label for="duration"class="col-sm-3 control-label col-form-label"><b>Day ' + i + '</b> Duration</label><div class="col-md-9"><input type="text" class="form-control" name="duration[]" id="duration"></div> </div><div class="form-group row"><label for="date" class="col-sm-3 control-label col-form-label"> <b>Day ' + i + '</b></label><div class="col-md-9"><input type="date" class="form-control" name="actualDate[]"  value="' + setdata + '" data-actualDate="' + x + '" id="actualDate' + x + '"></div></div> <input type="hidden" name="singleDurationInput[]"  id="singleDurationInput' + x + '"> <span id="singleDuration' + x + '"></span>  </div> <br ></div>'); //add input box
                                $(wrapper).append('<div> <center> <b style="font-size: 30px;">Day ' + i + '</b> </center>   <div class="form-group row"><label for="duration"class="col-sm-3 control-label col-form-label"><b>Day ' + i + '</b> Hours Worked</label><div class="col-md-9"><input type="number" class="form-control" required name="duration[]" placeholder="Enter Duration for ' + setdata + ' " id="duration"></div> </div><div class="form-group row"><label for="date" class="col-sm-3 control-label col-form-label"> <b>Day ' + i + ' </b>Date</label><div class="col-md-9"><input type="date" disabled class="form-control" name="actualDate[]"  value="' + setdata + '" data-actualDate="' + x + '" id="actualDate' + x + '"></div></div> <input type="hidden" name="singleDurationInput[]"  id="singleDurationInput' + x + '"> <span id="singleDuration' + x + '"></span>  </div> <br ></div> <hr style="border:2">'); //add input box
                                delete setdata;
                            }

                        }

                        function formatDate(date) {
                            var dd = date.getDate();
                            var mm = date.getMonth() + 1;
                            var yyyy = date.getFullYear();
                            if (dd < 10) { dd = '0' + dd }
                            if (mm < 10) { mm = '0' + mm }
                            // date = mm + '/' + dd + '/' + yyyy;
                            date = yyyy + '-' + mm + '-' + dd;
                            return date
                        }
                    });
                });

                // $(document).on('click', '#fromDate', function () {
                //     alert(this.id);
                //     alert($('#fromDate').data('fromDate'));
                // jQuery('#fromDate').datepicker({
                //     format: 'dd/mm/yyyy',
                //     maxDate: new Date(),
                //     closeOnSelected: true,
                //     autoclose: true,
                //     endDate: "today"
                // });



                // })
                // $(document).on('click', '#toDate', function () {
                // jQuery('#toDate').datepicker({
                //     format: 'dd/mm/yyyy',
                //     maxDate: new Date(),
                //     closeOnSelected: true,
                //     autoclose: true,
                //     endDate: "today"
                // });
                // })
                // --------------------------------------Multiple form---------------------------------

            });
            let date = new Date();
            var currentdate =
                ("00" + (date.getMonth() + 1)).slice(-2) + "/" +
                ("00" + date.getDate()).slice(-2) + "/" +
                date.getFullYear();
            function calculateAge(birthDate, otherDate) {
                birthDate = new Date(birthDate);
                otherDate = new Date(otherDate);

                var years = (otherDate.getFullYear() - birthDate.getFullYear());

                if (otherDate.getMonth() < birthDate.getMonth() ||
                    otherDate.getMonth() == birthDate.getMonth() && otherDate.getDate() < birthDate.getDate()) {
                    years--;
                }

                return years;
            }






            $("#updateEmployment").submit(function (event) {
                event.preventDefault();

                var values = {};
                $.each($('#updateEmployment').serializeArray(), function (i, field) {
                    values[field.name] = field.value;
                    // console.log(values[field.name]);
                });

                var duration = $("input[name='duration[]']")
                    .map(function () { return $(this).val(); }).get();
                values['durationArr'] = duration

                var actualDate = $("input[name='actualDate[]']")
                    .map(function () { return $(this).val(); }).get();
                values['actualDateArr'] = actualDate

                console.log(values);
                $('#durationCalc').trigger('click');

                values['totalDuration'] = $('#totalDurationData').text();
                // alert(values['totalDuration'])
                // let singleDurationInput = []
                // var total = 0;
                // $('input[name="singleDurationInput[]"]').each(function () {
                //     singleDurationInput.push(this.value);
                //     total += parseInt(this.value)
                // });
                // console.log(total);
                // if (actionData != 'Update') {
                //     if (total < 120) {
                //         // alert('atleast')
                //         Swal.fire({
                //             title: 'Error!',
                //             text: 'Atleast need 120 months to proceed further',
                //             icon: 'error',
                //             confirmButtonText: 'Ok'
                //         })
                //         return false
                //     }
                // }

                // alert(datas)
                Swal.fire({
                    title: 'Are you sure?',
                    text: "You want to update this!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Yes, update it!'
                }).then((result) => {
                    if (result.isConfirmed) {
                        $("#submitBtn").text('Please wait');
                        $("#submitBtn").attr('disabled', true);
                        $.ajax({
                            url: "/insertHos",
                            type: "POST",
                            data: values,
                            success: function (data) {
                                if (data.status) {
                                    const Toast = Swal.mixin({
                                        toast: true,
                                        position: 'top-end',
                                        showConfirmButton: false,
                                        timer: 2000,
                                        timerProgressBar: true,
                                        didOpen: (toast) => {
                                            toast.addEventListener('mouseenter', Swal.stopTimer)
                                            toast.addEventListener('mouseleave', Swal.resumeTimer)
                                        }
                                    })
                                    Toast.fire({
                                        icon: 'success',
                                        title: data.message
                                    });
                                    setTimeout(function () {
                                        window.location.reload();
                                    }, 2000);
                                } else {
                                    Swal.fire({
                                        title: 'Error!',
                                        text: 'Something went wrong',
                                        icon: 'error',
                                        confirmButtonText: 'Cool'
                                    })
                                }

                            }
                        });


                    }
                })
            });



        </script>
        <script src="sweetAlert/sweetalert2.min.js"></script>

</body>

</html>